rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    match /users/{userId} {
      allow read: if userId == authUserUid();
      allow create: if userId == authUserUid() && isValidUserCreate();
    }

    function isValidUserCreate() {
      return newData().keys().hasOnly(['role', 'devOpsMaturity', 'email'])
        && newData().role is string
        && newData().devOpsMaturity is string
        && newData().email == request.auth.token.email;
    }
  }


  function newData() {
    return request.resource.data;
  }

  function authUserUid() {
    return request.auth.uid;
  }

  function isAuthenticated() {
    return request.auth != null;
  }
}
